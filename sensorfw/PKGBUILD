# Maintainer: Deepak Meena <notwho53@gmail.com>
pkgname=sensorfw
pkgver=0.15.1
pkgrel=1
pkgdesc="Sensor framework daemon"
arch=('aarch64')
url="https://github.com/sailfishos/sensorfw"
license=('GPL-2.1')
makedepends=('qt6-base' 'udev' 'systemd' 'doxygen' 'graphviz' 'libhardware-dev' 'android-headers' 
  'libhybris-dev' 'glib2-devel' 'libglibutil-dev' 'libgbinder-dev')
source=("git+$url.git")
sha256sums=('SKIP')

_projname=sensorfw
_builddir=build

prepare() {
    cd "$srcdir/$pkgname"
    mkdir -p "$_builddir"
}

build() {
    cd "$srcdir/$pkgname/$_builddir"

    export CFLAGS="-Wall -g -Wno-psabi"
    [[ "$CFLAGS" != *-O* ]] && CFLAGS+=" -O2"

    qmake6 CONFIG+="configs autohybris binder systemdunit" \
        QMAKE_CXXFLAGS="$CFLAGS" MAKE_DOCS=yes ../${_projname}.pro

    make -j$(nproc)

    sed "s|@LIB@|lib/$(uname -m)-linux-gnu|g" "$srcdir/$pkgname/sensord-qt6.pc.in" \
        > "$srcdir/$pkgname/sensord-qt6.pc"
}

package() {
    cd "$srcdir/$pkgname/$_builddir"

    make INSTALL_ROOT="$pkgdir" install

    install -Dm644 "$srcdir/$pkgname/sensord-qt6.pc" \
        "$pkgdir/usr/lib/pkgconfig/sensord-qt6.pc"


}
